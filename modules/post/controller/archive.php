<?php namespace NextFeed\Modules\Post\Controller;defined('ABSPATH')||exit;use \NextFeed\Modules\Post AS Post;class Archive{private static $instance;public $post_type,$keys;public function __init(){$this->post_type=Post\Cpt::instance()->get_name();$this->keys=Post\Cpt::instance()->get_key();add_filter('body_class',array($this,'__body_classes'));add_filter('archive_template',[$this,'_get_single_template']);add_action('nextfeed_archive_post_content',[$this,'_the_page_content']);}public function get_dir(){return dirname(__FILE__);}public function _get_single_template($single){global $post;if(get_post_type($post)==='post'&&is_archive()){$_template_id=$this->_single_post_template();if(!empty($_template_id)&&$_template_id!=0){$file='archive-post.php';$templates=$this->get_dir().'/view/archive-post.php';return $templates;}}return $single;}public function _get_template_part($slug,$name,$template){if($name==='single'){$_template_id=$this->_single_post_template();$file='single-post.php';$find[]=$this->get_dir().'/view/'.$file;if(!empty($_template_id)){$template=locate_template($find);if(!$template||(!empty($status_options['template_debug_mode'])&&current_user_can('manage_options'))){$templates=$this->get_dir().'/view/'.$file;return $templates;}}}return $template;}public function _single_post_template(){if(is_archive('post')){global $post;if(!property_exists($post,'ID')){return 0;}$_template_id=get_post_meta($post->ID,$this->keys.'_post__template',true);if($_template_id==0||$_template_id==''){$this->keys=Post\Cpt::instance()->get_key();$_template_id=get_option($this->keys.'_post-archive__setdefault',0);}return $_template_id;}return 0;}public function _the_page_content($post){$_template_id=$this->_single_post_template();if(!empty($_template_id)){$checkEditor=get_post_meta($_template_id,'_elementor_edit_mode',true);if($checkEditor&&class_exists('\Elementor\Plugin')&&did_action('elementor/loaded')){echo \Elementor\Plugin::$instance->frontend->get_builder_content_for_display($_template_id);}else{$post=get_post($_template_id);if(is_object($post)&&isset($post->post_content)){if(has_blocks($post->post_content)){$blocks=parse_blocks($post->post_content);$output='';foreach($blocks as $block){$output.=render_block($block);}echo $output;}}}}else{the_content();}}public function __body_classes($classes){if(is_archive('post')){$post_type=get_post_type();if($post_type=='post'||$this->post_type){$classes[]='nextfeed-archive';}}return $classes;}public function __post_class($classes){if(is_archive('post')){$post_type=get_post_type();if($post_type=='post'||$this->post_type){$classes[]='nextfeed-post';}}return $classes;}public static function instance(){if(!self::$instance){self::$instance=new self();}return self::$instance;}}