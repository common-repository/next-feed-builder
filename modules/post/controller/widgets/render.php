<?php namespace NextFeed\Modules\Post\Controller\Widgets;defined('ABSPATH')||exit;use \NextFeed\Modules\Post\Cpt as Cpt;use \NextFeed\Utilities\Help as Help;Class Render{private static $instance=null;public static function _get_id_default($post_id=0,$_category_id=0){if($post_id!=0||$post_id!=''){return (int) $post_id;}$args=array('posts_per_page'=>1,'post_type'=>'post','post_status'=>'publish',);if($_category_id!=0||$_category_id!=''){$args['tax_query']=array(array('taxonomy'=>'post_cat','field'=>'term_id','terms'=>$_category_id,'operator'=>'IN'));$get_post_id=0;$posts=new WP_Query($args);while($posts->have_posts()){$posts->the_post();$get_post_id=get_the_ID();}if(!empty($get_post_id)){$post_id=$get_post_id;}return (int) $post_id;wp_reset_postdata();}$post_q=get_posts($args);if(!isset($post_q[0])){return (int) $post_id;}$post_id=$post_q[0]->ID;return (int) $post_id;}public function post_type(){return Cpt::instance()->get_name();}public function support_posttype(){return Cpt::instance()->_support_posttype();}public function _render_post($type='blog-title',$settings=array()){global $post;$post_type=get_post_type();if(in_array($post_type,$this->support_posttype())){$post_id=$post->ID;$post=get_post($post_id);}else{$post_id=self::_get_id_default();$post=get_post($post_id);}if(empty($post)){return '';}switch($type){case 'blog-thumbnail':$size=isset($settings['nextfeed_image_size'])?$settings['nextfeed_image_size']:'post-thumbnail';$attr=['class'=>'next-feature img-responsive responsive--full','title'=>'Feature image'];return get_the_post_thumbnail($post,$size,$attr);break;case 'blog-title':return get_the_title($post_id);break;case 'blog-author':return get_post_field('post_author',$post_id);break;case 'blog-date':$format=isset($settings['_date_format'])?$settings['_date_format']:'d F';return get_the_date($format,$post_id);break;case 'blog-categories':$format=isset($settings['_categories_seperator'])?$settings['_categories_seperator']:'-';return get_the_category_list($format,$format,$post_id);break;case 'blog-tags':$before=isset($settings['_tags_seperator_before'])?$settings['_tags_seperator_before']:'<ul><li>';$seperator=isset($settings['_tags_seperator'])?$settings['_tags_seperator']:'</li><li>';$after=isset($settings['_tags_seperator_after'])?$settings['_tags_seperator_after']:'</li></ul>';return get_the_tag_list($before,$seperator,$after,$post_id);break;case 'blog-content':$_pro_content=get_post($post_id);$content=$_pro_content->post_content;if($content){$content=apply_filters('the_content',$content);$content=str_replace(']]>',']]&gt;',$content);}return $content;break;case 'blog-excerpt':$excerpt=get_the_excerpt($post_id);$content=apply_filters('nextfeed_short_description',$excerpt);if(!$content){return;}return $content;break;case 'post-share':$enable_next_social=isset($settings['_enable_next_social'])?$settings['_enable_next_social']:'no';ob_start();echo '<div class="nextfeed-socialshare " >';if(did_action('nextsocial/loaded')&&$enable_next_social=='yes'){$_select_providers=isset($settings['_select_providers'])?$settings['_select_providers']:[];$_select_styles=isset($settings['_select_styles'])?$settings['_select_styles']:'';$_custom_class=isset($settings['_custom_class'])?$settings['_custom_class']:'';$share=$this->_get_share();if(is_array($_select_providers)&&isset($_select_providers[0])&&$_select_providers[0]!='all'){$share->allow_pro=$_select_providers;}if(!empty($_select_styles)){$share->btn_style=$_select_styles;}if(!empty($_custom_class)){$share->class_name=$_custom_class;}echo $share->next_sharing_shortcode_action();}else{add_filter('nxfeed_share_button',[$this,'add_share_link']);echo $this->generate_social();}echo '</div>';return ob_get_clean();break;}}public function _get_share(){if(did_action('nextsocial/loaded')){if(class_exists('\themeDevSocial\Apps\Sharing')){$obj=new \themeDevSocial\Apps\Sharing(false);return $obj;}}return;}public static function _instance(){if(!self::$instance){self::$instance=new self();}return self::$instance;}public static function share_options(){$link['facebook']=['label'=>'Facebook','url'=>'http://www.facebook.com/sharer.php','icon'=>'nx-social nx-social-facebook','params'=>['u'=>'[%url%]','t'=>'[%title%]','v'=>3]];$link['twitter']=['label'=>'Twitter','url'=>'https://twitter.com/intent/tweet','icon'=>'nx-social nx-social-twitter','params'=>['text'=>'[%title%] [%url%]','original_referer'=>'[%url%]','related'=>'[%author%]']];$link['linkedin']=['label'=>'LinkedIn','url'=>'https://www.linkedin.com/shareArticle','icon'=>'nx-social nx-social-linkedin','params'=>['url'=>'[%url%]','title'=>'[%title%]','summary'=>'[%details%]','source'=>'[%source%]','mini'=>true]];$link['pinterest']=['label'=>'Pinterest','url'=>'https://pinterest.com/pin/create/button/','icon'=>'nx-social nx-social-pinterest','params'=>['url'=>'[%url%]','media'=>'[%media%]','description'=>'[%details%]']];$link['whatsapp']=['label'=>'WhatsApp','url'=>'whatsapp://send','icon'=>'nx-social nx-social-whatsapp','params'=>['text'=>'[%title%] [%url%]']];$link['email']=['label'=>'Email','url'=>'mailto:','icon'=>'nx-social nx-social-email','params'=>['body'=>'Title: [%title%] \n\n URL: [%url%]','subject'=>'[%title%]']];return apply_filters('nxfeed_share_button',$link);}public function add_share_link($link){$link['link']=['label'=>'Copy Link','onclick'=>'nexfeed_copy_link(this)','url'=>'','params'=>['url'=>'[%url%]'],'icon'=>'nx-social nx-social-link'];return $link;}public function generate_social(){$link=self::share_options();if(empty($link)&&!is_array($link)){return '';}$post_type=get_post_type();if(in_array($post_type,$this->support_posttype())){global $post;$post_id=$post->ID;$post=get_post($post_id);}else{$post_id=self::_get_id_default();$post=get_post($post_id);}if(empty($post)){return '';}global $currentUrl,$title,$author,$details,$source,$media,$app_id;$currentUrl=(isset($_SERVER['HTTPS'])&&$_SERVER['HTTPS']==='on'?'https':'http').'://'.$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI'];if(is_object($post)&&isset($post->ID)){$currentUrl=get_permalink();}$postId=isset($post->ID)?$post->ID:0;$post_meta=get_post_meta($postId,'nx_share_data__');$current_id=get_current_user_id();$author='themedev';$details='';if(isset($post->post_excerpt)&&strlen($post->post_excerpt)>2){$details=$post->post_excerpt;}$title=get_the_title();$source=get_bloginfo();$thumbnail_src=wp_get_attachment_image_src(get_post_thumbnail_id($postId),'full');$custom_logo_id=get_theme_mod('custom_logo');$image=wp_get_attachment_image_src($custom_logo_id,'full');$customLogo=isset($image[0])?$image[0]:'';$media=isset($thumbnail_src[0])?$thumbnail_src[0]:$customLogo;$app_id='463603197734720';$linkData='';$linkData.='<ul class="nxfeed-social">';foreach($link as $k=>$v){$label=isset($v['label'])?$v['label']:'';$url_get=isset($v['url'])?$v['url']:'';$params_data=isset($v['params'])?$v['params']:'';$onclick=isset($v['onclick'])?$v['onclick']:'nexfeed_share_link(this)';$icon=isset($v['icon'])?$v['icon']:'';$urlCon=array_combine(array_keys($params_data),array_map(function($v){global $currentUrl,$title,$author,$details,$source,$media,$app_id;return str_replace(['[%url%]','[%title%]','[%author%]','[%details%]','[%source%]','[%media%]','[%app_id%]'],[$currentUrl,$title,$author,$details,$source,$media,$app_id],$v);},$params_data));$params=http_build_query($urlCon,'&');if(!empty($url_get)){$linkData.='<li> <a href="javascript:void();"  class="nx-share-'.$k.'" title="'.$label.'" id="nxfeed_s_share__'.$k.'" data-link="'.$url_get.'?'.$params.'" onclick="'.$onclick.'"> <i class="'.$icon.'"></i> </a></li>';}else{$url_get=$currentUrl;$linkData.='<li> <a href="javascript:void();" class="nx-share-'.$k.'" title="'.$label.'" id="nxfeed_s_share__'.$k.'" data-link="'.$url_get.'" onclick="'.$onclick.'"> <i class="'.$icon.'"></i> </a></li>';}}$linkData.='</ul>';return $linkData;}}