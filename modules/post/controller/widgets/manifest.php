<?php namespace NextFeed\Modules\Post\Controller\Widgets;defined('ABSPATH')||exit;use \NextFeed\Utilities\Help as Help;Class Manifest{private static $instance=null;private function cate(){$cate=['post-single'=>'Blog Single - NX','blog-list'=>'Blog List - NX'];return apply_filters('nextfeed_widgets_cate_add',$cate);}public static function instance(){if(!self::$instance){self::$instance=new self();}return self::$instance;}public function init(){if(did_action('elementor/loaded')){add_action('elementor/elements/categories_registered',[$this,'_elementor_widget_categories']);add_action('elementor/widgets/widgets_registered',[$this,'_register_widgets']);}add_filter('block_categories',[$this,'_widget_categories'],20,2);add_action('init',[$this,'_register_widgets_gutten']);}public function _widgets(){$widgets=['post-title'=>['key'=>'single'],'post-content'=>['key'=>'single'],'post-image'=>['key'=>'single'],'post-excerpt'=>['key'=>'single'],'post-date'=>['key'=>'single'],'post-categories'=>['key'=>'single'],'post-tags'=>['key'=>'single'],'post-author'=>['key'=>'single'],'post-comment'=>['key'=>'single'],'post-comment-count'=>['key'=>'single'],'post-share'=>['key'=>'single'],];return apply_filters('nextfeed_widgets_add',$widgets);}public function _register_widgets(){if(empty($this->_widgets())||!is_array($this->_widgets())){return;}$getServices=get_option('__next_feed_active','');$status=true;$active=[];if(is_array($getServices)&&isset($getServices['feed'])){$active=array_keys($getServices['feed']);$status=false;}foreach($this->_widgets()as $k=>$v):if(!in_array($k,$active)&&!$status){continue;}$files=plugin_dir_path(__FILE__).$v['key'].'/'.$k.'.php';if(file_exists($files)){require_once $files;$class_name='\Elementor\NextFedd_'.Help::_make_classname($k);\Elementor\Plugin::instance()->widgets_manager->register_widget_type(new $class_name());}endforeach;}public function _elementor_widget_categories($elements_manager){foreach($this->cate()as $k=>$v):\Elementor\Plugin::$instance->elements_manager->add_category('nextfeed-'.$k,['title'=>esc_html__($v,'next-feed'),'icon'=>'fa fa-plug',]);endforeach;}public function _register_widgets_gutten($widgets_manager){if(empty($this->_widgets())||!is_array($this->_widgets())){return;}$getServices=get_option('__next_feed_active','');$status=true;$active=[];if(is_array($getServices)&&isset($getServices['feed'])){$active=array_keys($getServices['feed']);$status=false;}foreach($this->_widgets()as $k=>$v):$type=isset($v['type'])?$v['type']:'';if(!in_array($k,$active)&&!$status){continue;}$files=plugin_dir_path(__FILE__).$v['key'].'/'.$k.'-block.php';if(file_exists($files)){require_once($files);$class='\NextFeedBlock\NB_'.Help::_make_classname($k);$class::instance()->_init();}endforeach;}public function _widget_categories($categories,$post){if(empty($this->cate())||!is_array($this->cate())){return $categories;}$my_cate=[];foreach($this->cate()as $k=>$v):$my_cate[]=['slug'=>'nextfeed-'.$k,'title'=>__($v,'next-feed'),'icon'=>''];endforeach;return array_merge($categories,$my_cate);}}